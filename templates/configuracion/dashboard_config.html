{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% block content %}
<style>
  .config-form label {
    color: #222 !important;
  }
  .config-form input, .config-form select, .config-form textarea {
    color: #222 !important;
    background: #fff !important;
    border: 1px solid #bbb;
  }
  .config-form .helptext, .config-form .text-danger, .config-form .errorlist, .config-form ul.errorlist li,
  .config-form .form-text, .config-form .invalid-feedback, .config-form .valid-feedback,
  .config-form .password-help, .config-form .form-group .help-block {
    color: #222 !important;
    background: transparent !important;
    font-size: 0.97rem;
    opacity: 1 !important;
    text-shadow: none !important;
  }
  .preview-image {
    max-width: 100%;
    max-height: 300px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  .current-image {
    background: #f8f9fa;
    border: 2px dashed #dee2e6;
    border-radius: 8px;
    padding: 20px;
    text-align: center;
  }
  .limpiar-option {
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    border-radius: 8px;
    padding: 15px;
    margin-top: 15px;
  }
</style>

<div class="container py-5">
  <div class="row">
    <div class="col-12">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="/configuracion/administrar/" class="text-decoration-none">Panel de Administración</a></li>
          <li class="breadcrumb-item active" aria-current="page">Configuración Dashboard</li>
        </ol>
      </nav>
    </div>
  </div>

  <div class="row">
    <div class="col-md-8">
      <div class="card shadow-sm border-0 mb-4">
        <div class="card-header bg-primary text-white">
          <h5 class="fw-bold mb-0"><i class="bi bi-image"></i> Configuración de Imagen de Fondo del Dashboard</h5>
        </div>
        <div class="card-body">
          <form method="post" enctype="multipart/form-data" class="config-form">
            {% csrf_token %}
            
            <!-- Campo de imagen -->
            <div class="mb-3">
              <label for="{{ form.imagen_fondo.id_for_label }}" class="form-label fw-bold">
                <i class="bi bi-upload"></i> {{ form.imagen_fondo.label }}
              </label>
              {{ form.imagen_fondo }}
              {% if form.imagen_fondo.help_text %}
                <div class="form-text">{{ form.imagen_fondo.help_text }}</div>
              {% endif %}
              {% if form.imagen_fondo.errors %}
                <div class="text-danger">{{ form.imagen_fondo.errors }}</div>
              {% endif %}
            </div>

            <!-- Opción de limpiar imagen -->
            {% if config.imagen_fondo %}
            <div class="limpiar-option">
              <div class="form-check">
                {{ form.limpiar_imagen }}
                <label class="form-check-label fw-bold text-warning" for="{{ form.limpiar_imagen.id_for_label }}">
                  <i class="bi bi-trash"></i> {{ form.limpiar_imagen.label }}
                </label>
                <div class="form-text">{{ form.limpiar_imagen.help_text }}</div>
              </div>
            </div>
            {% endif %}

            <!-- Errores generales del formulario -->
            {% if form.non_field_errors %}
              <div class="alert alert-danger mt-3">
                {% for error in form.non_field_errors %}
                  <i class="bi bi-exclamation-triangle"></i> {{ error }}
                {% endfor %}
              </div>
            {% endif %}

            <div class="d-flex gap-2 mt-4">
              <button type="submit" class="btn btn-primary">
                <i class="bi bi-save"></i> Guardar Cambios
              </button>
              <a href="/configuracion/administrar/" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Volver
              </a>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <div class="col-md-4">
      <div class="card shadow-sm border-0">
        <div class="card-header bg-info text-white">
          <h6 class="fw-bold mb-0"><i class="bi bi-eye"></i> Vista Previa</h6>
        </div>
        <div class="card-body">
          {% if config.imagen_fondo %}
            <div class="current-image">
              <img src="{{ config.imagen_fondo.url }}" alt="Imagen actual del dashboard" class="preview-image">
              <p class="text-muted mt-2 mb-0">Imagen actual del dashboard</p>
              <small class="text-muted">Última actualización: {{ config.actualizado|date:'d/m/Y H:i' }}</small>
            </div>
          {% else %}
            <div class="current-image">
              <i class="bi bi-image display-4 text-muted"></i>
              <p class="text-muted mt-2 mb-0">No hay imagen configurada</p>
              <small class="text-muted">Se usará la imagen por defecto</small>
            </div>
          {% endif %}
        </div>
      </div>
      
      <div class="card shadow-sm border-0 mt-3">
        <div class="card-header bg-warning text-dark">
          <h6 class="fw-bold mb-0"><i class="bi bi-info-circle"></i> Información</h6>
        </div>
        <div class="card-body">
          <ul class="list-unstyled mb-0">
            <li><i class="bi bi-check-circle text-success"></i> Formatos soportados: JPG, PNG, GIF</li>
            <li><i class="bi bi-check-circle text-success"></i> Tamaño recomendado: 1200x800px</li>
            <li><i class="bi bi-check-circle text-success"></i> Peso máximo: 5MB</li>
            <li><i class="bi bi-check-circle text-success"></i> Se mostrará en el dashboard principal</li>
            <li><i class="bi bi-check-circle text-success"></i> La imagen anterior se elimina automáticamente</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} 